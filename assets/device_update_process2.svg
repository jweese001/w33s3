<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="800" height="900" viewBox="0 0 800 900">
  <defs>
    <style>
      .start-end { fill: #90EE90; stroke: #333; stroke-width: 2; }
      .process { fill: #87CEEB; stroke: #333; stroke-width: 2; }
      .decision { fill: #FFB6C1; stroke: #333; stroke-width: 2; }
      .text { font-family: Arial, sans-serif; font-size: 12px; text-anchor: middle; dominant-baseline: middle; }
      .small-text { font-family: Arial, sans-serif; font-size: 10px; text-anchor: middle; dominant-baseline: middle; }
      .title { font-family: Arial, sans-serif; font-size: 18px; font-weight: bold; text-anchor: middle; }
      .line { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .decision-text { font-family: Arial, sans-serif; font-size: 11px; text-anchor: middle; dominant-baseline: middle; }
      .label-text { font-family: Arial, sans-serif; font-size: 10px; text-anchor: middle; fill: #666; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="400" y="30" class="title">Device Startup and Update Process</text>
  
  <!-- Start -->
  <ellipse cx="400" cy="80" rx="80" ry="30" class="start-end"/>
  <text x="400" y="80" class="text">Device Powers On</text>
  
  <!-- Main Flow Column -->
  <!-- WX Updater Launch -->
  <rect x="320" y="140" width="160" height="50" class="process"/>
  <text x="400" y="160" class="text">WX Updater Launches</text>
  <text x="400" y="175" class="text">After Android Boot</text>
  
  <!-- Check Connectivity -->
  <rect x="320" y="220" width="160" height="50" class="process"/>
  <text x="400" y="240" class="text">Check Connectivity to</text>
  <text x="400" y="255" class="text">WX Backend Server</text>
  
  <!-- Check for Updates -->
  <rect x="320" y="300" width="160" height="50" class="process"/>
  <text x="400" y="320" class="text">Check for Updates to</text>
  <text x="400" y="335" class="text">WX Utility Service</text>
  
  <!-- Launch Health Matters -->
  <rect x="320" y="380" width="160" height="50" class="process"/>
  <text x="400" y="400" class="text">Launch Health Matters</text>
  <text x="400" y="415" class="text">Primary Application</text>
  
  <!-- Send Tracking Data -->
  <rect x="320" y="460" width="160" height="50" class="process"/>
  <text x="400" y="480" class="text">Send Device Tracking</text>
  <text x="400" y="495" class="text">Data to Server</text>
  
  <!-- Close Updater -->
  <rect x="320" y="540" width="160" height="50" class="process"/>
  <text x="400" y="565" class="text">Close After Startup Tasks</text>
  
  <!-- Background Service Branch -->
  <!-- WX Utility Background Service -->
  <rect x="50" y="640" width="200" height="80" class="process"/>
  <text x="150" y="660" class="text">WX Utility Background Service:</text>
  <text x="150" y="675" class="small-text">• Set filesystem permissions</text>
  <text x="150" y="690" class="small-text">• Verify timezone</text>
  <text x="150" y="705" class="small-text">• Clear app caches</text>
  
  <!-- Update Check Decision -->
  <polygon points="400,630 480,660 400,690 320,660" class="decision"/>
  <text x="400" y="655" class="decision-text">Updates</text>
  <text x="400" y="670" class="decision-text">Available?</text>
  
  <!-- Download Updates -->
  <rect x="550" y="630" width="140" height="60" class="process"/>
  <text x="620" y="655" class="text">Download Updates</text>
  <text x="620" y="670" class="text">in Background</text>
  
  <!-- Reboot Decision -->
  <polygon points="400,750 480,780 400,810 320,780" class="decision"/>
  <text x="400" y="775" class="decision-text">Scheduled</text>
  <text x="400" y="790" class="decision-text">Reboot?</text>
  
  <!-- Install Updates and Reboot -->
  <rect x="550" y="740" width="140" height="80" class="process"/>
  <text x="620" y="765" class="text">Install Updates</text>
  <text x="620" y="780" class="text">Send Tracking Data</text>
  <text x="620" y="795" class="text">Reboot Device</text>
  
  <!-- Main Flow Connection Lines -->
  <path d="M 400 110 L 400 140" class="line"/>
  <path d="M 400 190 L 400 220" class="line"/>
  <path d="M 400 270 L 400 300" class="line"/>
  <path d="M 400 350 L 400 380" class="line"/>
  <path d="M 400 430 L 400 460" class="line"/>
  <path d="M 400 510 L 400 540" class="line"/>
  
  <!-- Split to Utility Service and Decision -->
  <path d="M 400 590 L 400 610" class="line"/>
  <!-- To Utility Service -->
  <path d="M 400 610 L 150 610 L 150 640" class="line"/>
  <!-- To Decision -->
  <path d="M 400 610 L 400 630" class="line"/>
  
  <!-- Update Check Decision - Yes path -->
  <path d="M 480 660 L 520 660 L 520 650 L 550 650" class="line"/>
  <text x="515" y="645" class="label-text">Yes</text>
  
  <!-- Update Check Decision - No path -->
  <path d="M 320 660 L 280 660 L 280 720 L 280 780 L 320 780" class="line"/>
  <text x="300" y="645" class="label-text">No</text>
  
  <!-- From downloads to reboot decision -->
  <path d="M 620 690 L 620 720 L 450 720 L 450 740 L 400 740 L 400 750" class="line"/>
  
  <!-- Reboot Decision - Yes path -->
  <path d="M 480 780 L 520 780 L 520 770 L 550 770" class="line"/>
  <text x="515" y="765" class="label-text">Yes</text>
  
  <!-- Reboot Decision - No path (continue monitoring) -->
  <path d="M 320 780 L 280 780 L 280 720 L 250 720 L 250 700 L 50 700" class="line"/>
  <text x="300" y="765" class="label-text">No</text>
  
  <!-- From Utility Service back to Update Check (monitoring loop) -->
  <path d="M 150 720 L 150 760 L 280 760" class="line"/>
  
  <!-- Loop back to start after reboot -->
  <path d="M 620 820 L 620 860 L 750 860 L 750 80 L 480 80" class="line"/>
  
  <!-- Utility Service checks for updates (feedback to decision) -->
  <path d="M 250 680 L 300 680 L 300 660 L 320 660" class="line" stroke-dasharray="5,5" opacity="0.7"/>
</svg>